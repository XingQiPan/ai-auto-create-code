# Auto Coding Agent - 项目指令模板

<!-- 此模板由 init-project.sh 根据项目描述自动生成 -->
<!-- 手动使用时，请填写以下信息 -->

## 项目信息

- **项目名称**: [项目名称]
- **技术栈**: [自动识别或手动填写]
- **语言**: [TypeScript / Python / Go / Java / Rust / ...]
- **框架**: [Next.js / FastAPI / Gin / Spring / ...]
- **数据库**: [PostgreSQL / MySQL / MongoDB / ...]
- **描述**: [项目简介]

---

## 开发环境

### 环境要求
<!-- 根据技术栈自动填写 -->
- [Node.js 20+ / Python 3.11+ / Go 1.21+ / JDK 17+]
- [数据库要求]

### 常用命令
<!-- 根据技术栈自动填写 -->

```bash
# 安装依赖
[npm install / pip install -r requirements.txt / go mod download]

# 启动开发服务器
[npm run dev / uvicorn main:app / go run main.go]

# 运行测试
[npm test / pytest / go test ./...]

# 构建项目
[npm run build / ...]

# 代码检查
[npm run lint / ruff check / golint]
```

---

## 📚 项目知识库

**重要：** 在开始任何开发任务前，请先阅读以下知识库文件了解项目：

- @knowledge/SUMMARY.md - 项目概览（必读）
- @knowledge/ARCHITECTURE.md - 架构设计
- @knowledge/MODULES.md - 模块清单和代码位置

**专项参考：**
- API 问题 → @knowledge/API.md
- 数据结构问题 → @knowledge/DATA-MODELS.md
- 业务流程问题 → @knowledge/KEY-FLOWS.md
- 快速检索 → @knowledge/INDEX.json

> 如果知识库文件不存在，请先运行 `./build-knowledge.sh` 生成。

---

## ⚡ 可用技能

根据任务类型，调用对应的技能增强能力：

| 任务类型 | 调用技能 |
|----------|----------|
| 理解项目结构 | @skills/code-analysis/SKILL.md |
| 修复 Bug | @skills/debug/SKILL.md |
| 编写测试 | @skills/testing/SKILL.md |
| 设计 API | @skills/api-design/SKILL.md |
| 架构设计 | @skills/architecture/SKILL.md |
| 安全检查 | @skills/security/SKILL.md |

**使用方式：** 在开始相关任务前，先阅读对应的 SKILL.md 文件，遵循其中的流程和模式。

---

## 核心规则：Agent 工作流程

**每次新的 Agent 会话必须遵循以下工作流程：**

### 步骤 1：环境初始化

```bash
./init.sh
```

这将：
- 安装所有依赖
- 启动开发服务器

**不要跳过此步骤。** 确保服务器运行后再继续。

---

### 步骤 2：选择下一个任务

读取 `task.json` 并选择 **一个** 任务来执行。

选择优先级（按顺序）：
1. 选择 `passes: false` 的任务
2. 考虑依赖关系 - 基础功能应先完成
3. 选择优先级最高的未完成任务

---

### 步骤 3：实现任务

- 仔细阅读任务描述和步骤
- 实现功能以满足所有步骤
- 遵循现有代码模式和约定
- **不要过度设计** - 只实现任务要求的功能

---

### 步骤 4：彻底测试

实现后，验证任务中的 **所有步骤**：

**测试要求（强制）：**

1. **大幅页面修改**（新建页面、重写组件、修改核心交互）：
   - **必须在浏览器中测试！**
   - 验证页面正确加载和渲染
   - 验证表单提交、按钮点击等交互功能

2. **小幅代码修改**（修复 bug、调整样式、添加辅助函数）：
   - 可以使用单元测试或 lint/build 验证
   - 如有疑虑，仍建议浏览器测试

3. **所有修改必须通过**：
   - `npm run lint` 无错误（或项目对应的检查命令）
   - `npm run build` 构建成功（或项目对应的构建命令）
   - 浏览器/单元测试验证功能正常

**测试清单：**
- [ ] 代码没有类型错误
- [ ] lint 通过
- [ ] build 成功
- [ ] 功能在浏览器中正常工作（对于 UI 相关修改）

---

### 步骤 5：更新进度

将工作内容写入 `progress.txt`：

```
## [日期] - Task: [任务描述]

### 完成内容:
- [具体完成的修改]

### 测试:
- [如何测试的]

### 备注:
- [任何相关的备注，供后续 Agent 参考]
```

---

### 步骤 6：提交更改

**重要：所有更改必须在同一个 commit 中提交，包括 task.json 的更新！**

流程：
1. 更新 `task.json`，将任务的 `passes` 从 `false` 改为 `true`
2. 更新 `progress.txt` 记录工作内容
3. 一次性提交所有更改：

```bash
git add .
git commit -m "[任务描述] - completed"
```

**规则：**
- 只有在所有步骤都验证通过后才标记 `passes: true`
- 永远不要删除或修改任务描述
- 永远不要从列表中移除任务
- **一个任务的所有内容（代码、progress.txt、task.json）必须在同一个 commit 中提交**

---

## 阻塞处理

**如果任务无法完成或需要人工介入，必须遵循以下规则：**

### 需要停止任务并请求人工帮助的情况：

1. **缺少环境配置**：
   - .env 文件需要填写真实的 API 密钥
   - 外部服务需要创建和配置
   - 需要付费账号

2. **外部依赖不可用**：
   - 第三方 API 服务宕机
   - 需要人工授权的 OAuth 流程

3. **测试无法进行**：
   - 登录/注册功能需要真实用户账号
   - 功能依赖外部系统尚未部署

### 阻塞时的正确操作：

**禁止（DO NOT）：**
- ❌ 提交 git commit
- ❌ 将 task.json 的 passes 设为 true
- ❌ 假装任务已完成

**必须（DO）：**
- ✅ 在 progress.txt 中记录当前进度和阻塞原因
- ✅ 输出清晰的阻塞信息，说明需要人工做什么
- ✅ 停止任务，等待人工介入

### 阻塞信息格式：

```
🚫 任务阻塞 - 需要人工介入

**当前任务**: [任务名称]

**已完成的工作**:
- [已完成的代码/配置]

**阻塞原因**:
- [具体说明为什么无法继续]

**需要人工帮助**:
1. [具体的步骤 1]
2. [具体的步骤 2]

**解除阻塞后**:
- 运行 [命令] 继续任务
```

---

## 项目结构

```
/
├── CLAUDE.md          # 本文件 - 工作流程指令
├── task.json          # 任务定义（数据源）
├── progress.txt       # 进度日志
├── init.sh            # 初始化脚本
└── [你的项目目录]/     # 实际项目代码
```

---

## 代码规范

<!-- 根据你的项目自定义 -->
- [如: TypeScript strict mode]
- [如: 函数式组件 + Hooks]
- [如: 使用 ESLint + Prettier]
- [如: 为新功能编写测试]

---

## 关键规则总结

1. **每次会话一个任务** - 专注于完成好一个任务
2. **完成前必须测试** - 所有步骤必须通过
3. **UI 修改需浏览器测试** - 新建或大幅修改页面必须在浏览器测试
4. **记录到 progress.txt** - 帮助后续 Agent 理解你的工作
5. **一个任务一个 commit** - 所有更改必须在同一个 commit 中提交
6. **不要删除任务** - 只将 `passes: false` 改为 `true`
7. **阻塞时停止** - 需要人工介入时，不要提交，输出阻塞信息并停止
